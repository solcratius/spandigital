
///////////////////////////////////////////////////////////////////////////
// Configuration
///////////////////////////////////////////////////////////////////////////

var config = {
	jsConcatFiles: [
		'./js/controller.js',
		'./js/main.js',
		'./js/nav.js',
		'./js/landing.js'
	]
};


///////////////////////////////////////////////////////////////////////////
// Required
///////////////////////////////////////////////////////////////////////////

var gulp = require('gulp'),
	autoprefixer = require('gulp-autoprefixer'),
	browserSync = require('browser-sync'),
	concat = require('gulp-concat'),
	del = require('del'),
	reload = browserSync.reload,
	rename = require('gulp-rename'),
	sass = require('gulp-sass'),
	uglify = require('gulp-uglify');


///////////////////////////////////////////////////////////////////////////
// Log Errors
///////////////////////////////////////////////////////////////////////////

function errorlog(err){
	console.error(err.message);
	this.emit('end');
}


///////////////////////////////////////////////////////////////////////////
// Scripts Tasks
///////////////////////////////////////////////////////////////////////////

gulp.task('scripts', function() {
	return gulp.src(config.jsConcatFiles)
	.pipe(concat('temp.js'))
	.pipe(uglify())
	.on('error', errorlog)
	.pipe(rename('main.min.js'))
	.pipe(gulp.dest('./js'))
	.pipe(reload({stream:true}));
});


///////////////////////////////////////////////////////////////////////////
// Styles Tasks
///////////////////////////////////////////////////////////////////////////

gulp.task('styles', function() {
	return gulp.src('scss/*.scss')
	.pipe(sass({outputStyle: 'expanded'}))//'compressed'}))//
	.on('error', errorlog)
	.pipe(autoprefixer({
        browsers: ['last 3 versions', 'Firefox < 20', 'IE 8', 'IE 9', 'IE 10'],
        cascade: false
    }))
	.pipe(gulp.dest('./'))
	.pipe(reload({stream:true}));
});


///////////////////////////////////////////////////////////////////////////
// PHP Tasks
///////////////////////////////////////////////////////////////////////////

gulp.task('php', function() {
	gulp.src('./*.php')
	.pipe(reload({stream:true}));
});


///////////////////////////////////////////////////////////////////////////
// Browser-Sync Tasks
///////////////////////////////////////////////////////////////////////////

gulp.task('browser-sync', function() {
	var files = [
			'./style.css',
			'js/**/*.js',
			'./*.php',
			'**/*.{png,jpg,gif}',
			'**/*.{svg}'
		];
	browserSync.init(files, {
		proxy: "localhost/spandigital/",
		notify: false,
		injectChanges: true
	});
});


///////////////////////////////////////////////////////////////////////////
// Watch Tasks
///////////////////////////////////////////////////////////////////////////

gulp.task('watch', function() {
	gulp.watch('scss/**/*.scss', ['styles']);
	gulp.watch('js/**/*.js', ['scripts']);
	gulp.watch('./*.php', ['php']);
});

///////////////////////////////////////////////////////////////////////////
// Default Task
///////////////////////////////////////////////////////////////////////////

gulp.task('default', ['scripts', 'styles', 'browser-sync', 'watch']);
